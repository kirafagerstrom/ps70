<!DOCTYPE html>
<html lang="en">

<title>PS70: Intro to Digital Fabrication </title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="../style.css" rel="stylesheet">


<nav class="navbar navbar-expand-sm navbar-dark" style="background-color: #FFFFFF; color: #053034;">
  <div style="align-items: center; justify-content: center;" class="container-fluid">
    <div class="flexrow">
      <h2 class="nav-title">ps 70: intro to digital fabrication spring 24</h2>
    </div>
    <div class="navbar-nav">
      <h4><a class="nav-link" href="./index.html" style="color: #053034;">Home</a></h4>
      <h4><a class="nav-link" href="./about.html" style="color: #053034;">About</a></h4>
      <h4><a class="nav-link" href="./13_finalproject/index.html" style="color: #053034;">Final Project</a></h4>
    </div>
  </div>
</nav>

<body>
<xmp style="display:none;">
<div class="textcontainer">
<p class="margin">   </p>

<h3>Week 6: Electronic Inputs</h3>

<h4>Assignment: Build a Capacitive Sensor</h4>

This week, Kassia helped me develop a new idea for the pillbox project that included a capacitive sensing grid. Each compartment would have a capacitive sensor at the base that can sense the weight of the tablets so the device knows when pills have been placed in the box. If the capacitor senses the correct pill weight, then the indicator light for the compartment turns off. For the assignment, I attempted a simple 2x1 capacitive sensing grid with the idea of calibrating it by placing ibuoprofen tablets on the capacitor.<br>
I followed the tutorial on the class website and used CapacitiveSensor library example code, which I modified for use with only 2 sensors:
<p class="margin">   </p>
<div class="flexrow">
  <img src="./capacative sensor circut.jpeg" alt="a prototype capacitive sensor made of cardboard" width=50%>
</div>
<br>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inline Code Example</title>
</head>
<body>
    <h5>Code:</h5>
    <code>
        #include &lt;CapacitiveSensor.h&gt;<br>
        <br>
        /*<br>
         * CapitiveSense Library Demo Sketch<br>
         * Paul Badger 2008<br>
         * Uses a high value resistor e.g. 10M between send pin and receive pin<br>
         * Resistor effects sensitivity, experiment with values, 50K - 50M. Larger resistor values yield larger sensor values.<br>
         * Receive pin is the sensor pin - try different amounts of foil/metal on this pin<br>
         */<br>
        <br>
        CapacitiveSensor   cs_4_2 = CapacitiveSensor(4,2);        // 10M resistor between pins 4 &amp; 2, pin 2 is sensor pin, add a wire and or foil if desired<br>
        CapacitiveSensor   cs_4_6 = CapacitiveSensor(4,6);        // 10M resistor between pins 4 &amp; 6, pin 6 is sensor pin, add a wire and or foil<br>
        <br>
        void setup()                    <br>
        {<br>
           cs_4_2.set_CS_AutocaL_Millis(0xFFFFFFFF);     // turn off autocalibrate on channel 1 - just as an example<br>
           Serial.begin(9600);<br>
        }<br>
        <br>
        void loop()                    <br>
        {<br>
            long start = millis();<br>
            long total1 =  cs_4_2.capacitiveSensor(30);<br>
            long total2 =  cs_4_6.capacitiveSensor(30);<br>
        <br>
            Serial.print(millis() - start);        // check on performance in milliseconds<br>
            Serial.print("\t");                    // tab character for debug windown spacing<br>
        <br>
            Serial.print(total1);                  // print sensor output 1<br>
            Serial.print("\t");<br>
            Serial.println(total2);                  // print sensor output 2<br>
        <br>
            delay(300);                             // arbitrary delay to limit data to serial port <br>
        }<br>
    </code>
</body>
</html><br>

This was a good idea in theory but in practice it was a flop. When it came time to calibrate, adding pills to the sensor didn't change the Arduino reading. I thought this might be because I was using a 1 M ohm resistor, so I tried 3 and 10 M ohms to make it more sensitive. 3 M ohms still wasn't sensitive enough, but 10 M ohms was a bit too sensitive and the readings were affected by surrounding objects (mostly by me). I think the capacitance between the pills and the sensor was too small because of their small size (less surface area touching the capacitor) and their dielectric constant may be too low. My next attempt will be a transmit-receive weight sensor that will hopefully be able to sense the small changes in plate position caused by adding more tablets. I think using a thin but flexible dielectric between the two foil sheets will be more sensitive and easier to calibrate, but I'll try a variety of materials/thicknesses.<br>
<br>
<h5>Piezo vibration sensing</h5><br>
I pivoted to try another input: piezo sensing. When someone drops a pill in the compartment, it will cause a vibration that the piezo plate can sense. If the reading is above a certain threshold (indicating a pill was dropped into that compartment), then the LED for that compartment would turn off. I tried this with a small piezo plate placed below one of the compartments in my final printed pillbox. I dropped a pill in each compartment in the same row to get a sense of what the threshold would be for putting a pill in the respective compartment vs the others (which should have a lower reading).<br>
The code modified the example AnalogRead code to sum the voltage, as we did in the capacitive sensing code. It prints the voltage to the serial plotter and monitor, where I read the values upon dropping the pill in the compartment:
<div class="flexrow">
<video width="50%" autoplay muted>
  <source src="./piezosense.MOV" type="video/mp4">
  </video>
</div>

<iframe src="https://app.arduino.cc/sketches/fb910bef-fb13-4f49-8cb3-69385c17df22?view-mode=embed" style="height:510px;width:100%;margin:10px 0" frameborder=0 /></iframe><br>

The values were not super consistent, but there was at least a threshold of ~0.22 volts that distinguished between whether the pill was placed in the piezo sensed compartment or the adjacent compartment!

<p class="margin">   </p>
<div class="flexrow">
  <img src="./graph.png" alt="graph and table of piezo reading values" width=50%>
</div>


</div>
</xmp>
</body>

<script src="../strapdown.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" ></script>

</html>